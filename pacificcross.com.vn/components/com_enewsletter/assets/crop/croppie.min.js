!function(t,e){"function"==typeof define&&define.amd?define(["exports","b"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("b")):e(t.commonJsStrict={},t.b)}(this,function(exports){function t(t){if(t in Z)return t;for(var e=t[0].toUpperCase()+t.slice(1),n=B.length;n--;)if(t=B[n]+e,t in Z)return t}function e(t){t=t||{};for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var o in r)r.hasOwnProperty(o)&&(t[o]="object"==typeof r[o]?e({},r[o]):r[o])}return t}function n(t,e,n){var r;return function(){var o=this,i=arguments,s=function(){r=null,n||t.apply(o,i)},a=n&&!r;clearTimeout(r),r=setTimeout(s,e),a&&t.apply(o,i)}}function r(t){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),t.dispatchEvent(e)}else t.fireEvent("onchange")}function o(t,e,n){if("string"==typeof e){var r=e;e={},e[r]=n}for(var o in e)t.style[o]=e[o]}function i(t){var e=t.points,n=document.createElement("div"),r=document.createElement("img"),i=e[2]-e[0],s=e[3]-e[1];return n.classList.add("croppie-result"),n.appendChild(r),o(r,{left:-1*e[0]+"px",top:-1*e[1]+"px"}),r.src=t.url,o(n,{width:i+"px",height:s+"px"}),n}function s(t,e){var n=e.points,r=n[0],o=n[1],i=n[2]-n[0],s=n[3]-n[1],a=e.circle,u=document.createElement("canvas"),l=u.getContext("2d"),c=i,p=s;return e.outputWidth&&e.outputHeight&&(c=e.outputWidth,p=e.outputHeight),u.width=c,u.height=p,a&&(l.save(),l.beginPath(),l.arc(c/2,p/2,c/2,0,2*Math.PI,!0),l.closePath(),l.clip()),l.drawImage(t,r,o,i,s,0,0,c,p),u.toDataURL()}function a(t,e){var n,r=e||new Image;return n=new Promise(function(e){"http"===t.substring(0,4).toLowerCase()&&r.setAttribute("crossOrigin","anonymous"),r.onload=function(){setTimeout(function(){e(r)},1)}}),r.src=t,n}function u(){var t,e,n,r,i=this,s=["croppie-container"],a=i.options.viewport.type?"cr-vp-"+i.options.viewport.type:null;i.data={},i.elements={},t=i.elements.boundary=document.createElement("div"),n=i.elements.viewport=document.createElement("div"),e=i.elements.img=document.createElement("img"),r=i.elements.overlay=document.createElement("div"),t.classList.add("cr-boundary"),o(t,{width:i.options.boundary.width+"px",height:i.options.boundary.height+"px"}),n.classList.add("cr-viewport"),a&&n.classList.add(a),o(n,{width:i.options.viewport.width+"px",height:i.options.viewport.height+"px"}),e.classList.add("cr-image"),r.classList.add("cr-overlay"),i.element.appendChild(t),t.appendChild(e),t.appendChild(n),t.appendChild(r),i.element.classList.add(s),i.options.customClass&&i.element.classList.add(i.options.customClass),f.call(this),i.options.showZoom&&c.call(i)}function l(t){this.options.showZoom&&(this.elements.zoomer.value=b(t))}function c(){function t(){d.call(s),r=new z(s.elements.img),o=s.elements.viewport.getBoundingClientRect(),i=P.parse(s.elements.img)}function e(){p.call(s,{value:parseFloat(u.value),origin:r||new z(s.elements.img),viewportRect:o||s.elements.viewport.getBoundingClientRect(),transform:i||P.parse(s.elements.img)})}function n(n){var r,o;r=n.wheelDelta?n.wheelDelta/1200:n.deltaY?n.deltaY/1060:n.detail?n.detail/60:0,o=s._currentZoom+r,n.preventDefault(),t(),l.call(s,o),e()}var r,o,i,s=this,a=s.elements.zoomerWrap=document.createElement("div"),u=s.elements.zoomer=document.createElement("input");a.classList.add("cr-slider-wrap"),u.type="range",u.classList.add("cr-slider"),u.step="0.01",u.value=1,s.element.appendChild(a),a.appendChild(u),s._currentZoom=1,s.elements.zoomer.addEventListener("mousedown",t),s.elements.zoomer.addEventListener("touchstart",t),s.elements.zoomer.addEventListener("input",e),s.elements.zoomer.addEventListener("change",e),s.options.mouseWheelZoom&&(s.elements.boundary.addEventListener("mousewheel",n),s.elements.boundary.addEventListener("DOMMouseScroll",n))}function p(t){var e=this,n=t.transform,r=t.viewportRect,i=t.origin;e._currentZoom=t.value,n.scale=e._currentZoom;var s=m.call(e,r),a=s.translate,u=s.origin;n.x>=a.maxX&&(i.x=u.minX,n.x=a.maxX),n.x<=a.minX&&(i.x=u.maxX,n.x=a.minX),n.y>=a.maxY&&(i.y=u.minY,n.y=a.maxY),n.y<=a.minY&&(i.y=u.maxY,n.y=a.minY);var l={};l[Y]=n.toString(),l[R]=i.toString(),o(e.elements.img,l),F.call(e),g.call(e)}function m(t){var e=this,n=e._currentZoom,r=t.width,o=t.height,i=e.options.boundary.width/2,s=e.options.boundary.height/2,a=e._originalImageWidth,u=e._originalImageHeight,l=a*n,c=u*n,p=r/2,m=o/2,d=-1*(p/n-i),f=d-(l*(1/n)-r*(1/n)),h=-1*(m/n-s),g=h-(c*(1/n)-o*(1/n)),v=1/n*p,y=l*(1/n)-v,w=1/n*m,_=c*(1/n)-w;return{translate:{maxX:d,minX:f,maxY:h,minY:g},origin:{maxX:y,minX:v,maxY:_,minY:w}}}function d(){var t=this,e=t._currentZoom,n=t.elements.img.getBoundingClientRect(),r=t.elements.viewport.getBoundingClientRect(),i=P.parse(t.elements.img.style[Y]),s=new z(t.elements.img),a=r.top-n.top+r.height/2,u=r.left-n.left+r.width/2,l={},c={};l.y=a/e,l.x=u/e,c.y=(l.y-s.y)*(1-e),c.x=(l.x-s.x)*(1-e),i.x-=c.x,i.y-=c.y;var p={};p[R]=l.x+"px "+l.y+"px",p[Y]=i.toString(),o(t.elements.img,p)}function f(){function t(t){t.preventDefault(),p||(p=!0,i=t.pageX,s=t.pageY,transform=P.parse(c.elements.img),window.addEventListener("mousemove",e),window.addEventListener("touchmove",e),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[M]="none",u=c.elements.viewport.getBoundingClientRect())}function e(t){t.preventDefault();var e=t.pageX||t.touches[0].pageX,n=t.pageY||t.touches[0].pageY,p=e-i,m=n-s,d=c.elements.img.getBoundingClientRect(),f=transform.y+m,g=transform.x+p,v={};if("touchmove"==t.type&&t.touches.length>1){var y=t.touches[0],w=t.touches[1],_=Math.sqrt((y.pageX-w.pageX)*(y.pageX-w.pageX)+(y.pageY-w.pageY)*(y.pageY-w.pageY));a||(a=_/c._currentZoom);var x=_/a;return l.call(c,x),void r(c.elements.zoomer)}u.top>d.top+m&&u.bottom<d.bottom+m&&(transform.y=f),u.left>d.left+p&&u.right<d.right+p&&(transform.x=g),v[Y]=transform.toString(),o(c.elements.img,v),h.call(c),s=n,i=e}function n(){p=!1,window.removeEventListener("mousemove",e),window.removeEventListener("touchmove",e),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[M]="",d.call(c),g.call(c),a=0}var i,s,a,u,c=this,p=!1;c.elements.overlay.addEventListener("mousedown",t),c.elements.overlay.addEventListener("touchstart",t)}function h(){var t=this,e=t.elements.boundary.getBoundingClientRect(),n=t.elements.img.getBoundingClientRect();o(t.elements.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-e.top+"px",left:n.left-e.left+"px"})}function g(){var t=this;v.call(t)&&t.options.update.call(t,t.get())}function v(){return this.elements.img.offsetHeight>0&&this.elements.img.offsetWidth>0}function y(){var t,e,n,i,s,a=this,u=0,c=1.5,p=1,m={},d=a.elements.img,f=a.elements.zoomer,g=new P(0,0,p),y=new z,x=v.call(a);x&&!a.data.bound&&(a.data.bound=!0,m[Y]=g.toString(),m[R]=y.toString(),o(d,m),t=d.getBoundingClientRect(),e=a.elements.viewport.getBoundingClientRect(),n=a.elements.boundary.getBoundingClientRect(),a._originalImageWidth=t.width,a._originalImageHeight=t.height,a.options.showZoom&&(i=e.width/t.width,s=e.height/t.height,u=Math.max(i,s),u>=c&&(c=u+1),f.min=b(u),f.max=b(c),p=Math.max(n.width/t.width,n.height/t.height),l.call(a,p),r(f)),a._currentZoom=g.scale=p,m[Y]=g.toString(),o(d,m),a.data.points.length?w.call(a,a.data.points):_.call(a),h.call(a))}function w(t){if(4!=t.length)throw"Croppie - Invalid number of points supplied: "+t;var e=this,n=t[2]-t[0],r=e.elements.viewport.getBoundingClientRect(),i=e.elements.boundary.getBoundingClientRect(),s={left:r.left-i.left,top:r.top-i.top},a=r.width/n,u=t[1],c=t[0],p=-1*t[1]+s.top,m=-1*t[0]+s.left,d={};d[R]=c+"px "+u+"px",d[Y]=new P(m,p,a).toString(),o(e.elements.img,d),l.call(e,a),e._currentZoom=a}function _(){var t=this,e=t.elements.img.getBoundingClientRect(),n=t.elements.viewport.getBoundingClientRect(),r=t.elements.boundary.getBoundingClientRect(),i=n.left-r.left,s=n.top-r.top,a=i-(e.width-n.width)/2,u=s-(e.height-n.height)/2,l=new P(a,u,t._currentZoom);o(t.elements.img,Y,l.toString())}function x(t,e){var n,r=this,o=[];if("string"==typeof t)n=t,t={};else if(Array.isArray(t))o=t.slice();else{if("undefined"==typeof t&&r.data.url)return y.call(r),g.call(r),null;n=t.url,o=t.points||[]}r.data.bound=!1,r.data.url=n||r.data.url,r.data.points=(o||r.data.points).map(function(t){return parseFloat(t)});var i=a(n,r.elements.img);return i.then(function(){y.call(r),g.call(r),e&&e()}),i}function b(t){return parseFloat(t).toFixed(2)}function C(){var t=this,e=t.elements.img.getBoundingClientRect(),n=t.elements.viewport.getBoundingClientRect(),r=n.left-e.left,o=n.top-e.top,i=r+n.width,s=o+n.height,a=t._currentZoom;return(a===1/0||isNaN(a))&&(a=1),r=Math.max(0,r/a),o=Math.max(0,o/a),i=Math.max(0,i/a),s=Math.max(0,s/a),{points:[b(r),b(o),b(i),b(s)],zoom:a}}function E(t){var e,n,r=this,o=C.call(r),u=t||{type:"canvas",size:"viewport"},l="string"==typeof u?u:u.type,c=u.size||"viewport";return"viewport"===c&&(e=r.elements.viewport.getBoundingClientRect(),o.outputWidth=e.width,o.outputHeight=e.height),o.circle="circle"===r.options.viewport.type,o.url=r.data.url,n=new Promise(function(t){"canvas"===l?a(o.url).then(function(e){t(s(e,o))}):t(i(o))})}function L(){console.warn("Croppie.refresh() is deprecated.  Please use Croppie.bind() without any arguments instead.  refresh() will be removed in a later release."),y.call(this)}function S(){var t=this;t.element.removeChild(t.elements.boundary),t.options.showZoom&&t.element.removeChild(t.elements.zoomerWrap),delete t.elements}function A(t,n){this.element=t,this.options=e({},A.defaults,n),u.call(this)}"function"!=typeof Promise&&function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function r(t){W=t}function o(t){k=t}function i(){return function(){process.nextTick(c)}}function s(){return function(){T(c)}}function a(){var t=0,e=new Q(c),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=c,function(){t.port2.postMessage(0)}}function l(){return function(){setTimeout(c,1)}}function c(){for(var t=0;q>t;t+=2){var e=G[t],n=G[t+1];e(n),G[t]=void 0,G[t+1]=void 0}q=0}function p(){try{var t=require,e=t("vertx");return T=e.runOnLoop||e.runOnContext,s()}catch(n){return l()}}function m(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function h(t){try{return t.then}catch(e){return nt.error=e,nt}}function g(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function v(t,e,n){k(function(t){var r=!1,o=g(n,e,function(n){r||(r=!0,e!==n?_(t,n):b(t,n))},function(e){r||(r=!0,C(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,C(t,o))},t)}function y(t,e){e._state===tt?b(t,e._result):e._state===et?C(t,e._result):E(e,void 0,function(e){_(t,e)},function(e){C(t,e)})}function w(t,n){if(n.constructor===t.constructor)y(t,n);else{var r=h(n);r===nt?C(t,nt.error):void 0===r?b(t,n):e(r)?v(t,n,r):b(t,n)}}function _(e,n){e===n?C(e,d()):t(n)?w(e,n):b(e,n)}function x(t){t._onerror&&t._onerror(t._result),L(t)}function b(t,e){t._state===V&&(t._result=e,t._state=tt,0!==t._subscribers.length&&k(L,t))}function C(t,e){t._state===V&&(t._state=et,t._result=e,k(x,t))}function E(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+tt]=n,o[i+et]=r,0===i&&t._state&&k(L,t)}function L(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?R(n,r,o,i):o(i);t._subscribers.length=0}}function S(){this.error=null}function A(t,e){try{return t(e)}catch(n){return rt.error=n,rt}}function R(t,n,r,o){var i,s,a,u,l=e(r);if(l){if(i=A(r,o),i===rt?(u=!0,s=i.error,i=null):a=!0,n===i)return void C(n,f())}else i=o,a=!0;n._state!==V||(l&&a?_(n,i):u?C(n,s):t===tt?b(n,i):t===et&&C(n,i))}function Y(t,e){try{e(function(e){_(t,e)},function(e){C(t,e)})}catch(n){C(t,n)}}function M(t,e){var n=this;n._instanceConstructor=t,n.promise=new t(m),n._validateInput(e)?(n._input=e,n.length=e.length,n._remaining=e.length,n._init(),0===n.length?b(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&b(n.promise,n._result))):C(n.promise,n._validationError())}function B(t){return new ot(this,t).promise}function Z(t){function e(t){_(o,t)}function n(t){C(o,t)}var r=this,o=new r(m);if(!H(t))return C(o,new TypeError("You must pass an array to race.")),o;for(var i=t.length,s=0;o._state===V&&i>s;s++)E(r.resolve(t[s]),void 0,e,n);return o}function X(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(m);return _(n,t),n}function j(t){var e=this,n=new e(m);return C(n,t),n}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(t){this._id=lt++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==t&&(e(t)||P(),this instanceof F||z(),Y(this,t))}function I(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=ct)}var O;O=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var T,W,D,H=O,q=0,k=({}.toString,function(t,e){G[q]=t,G[q+1]=e,q+=2,2===q&&(W?W(c):D())}),N="undefined"!=typeof window?window:void 0,U=N||{},Q=U.MutationObserver||U.WebKitMutationObserver,J="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3);D=J?i():Q?a():K?u():void 0===N&&"function"==typeof require?p():l();var V=void 0,tt=1,et=2,nt=new S,rt=new S;M.prototype._validateInput=function(t){return H(t)},M.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},M.prototype._init=function(){this._result=new Array(this.length)};var ot=M;M.prototype._enumerate=function(){for(var t=this,e=t.length,n=t.promise,r=t._input,o=0;n._state===V&&e>o;o++)t._eachEntry(r[o],o)},M.prototype._eachEntry=function(t,e){var r=this,o=r._instanceConstructor;n(t)?t.constructor===o&&t._state!==V?(t._onerror=null,r._settledAt(t._state,e,t._result)):r._willSettleAt(o.resolve(t),e):(r._remaining--,r._result[e]=t)},M.prototype._settledAt=function(t,e,n){var r=this,o=r.promise;o._state===V&&(r._remaining--,t===et?C(o,n):r._result[e]=n),0===r._remaining&&b(o,r._result)},M.prototype._willSettleAt=function(t,e){var n=this;E(t,void 0,function(t){n._settledAt(tt,e,t)},function(t){n._settledAt(et,e,t)})};var it=B,st=Z,at=X,ut=j,lt=0,ct=F;F.all=it,F.race=st,F.resolve=at,F.reject=ut,F._setScheduler=r,F._setAsap=o,F._asap=k,F.prototype={constructor:F,then:function(t,e){var n=this,r=n._state;if(r===tt&&!t||r===et&&!e)return this;var o=new this.constructor(m),i=n._result;if(r){var s=arguments[r-1];k(function(){R(r,o,s,i)})}else E(n,o,t,e);return o},"catch":function(t){return this.then(null,t)}};var pt=I,mt={Promise:ct,polyfill:pt};"function"==typeof define&&define.amd?define(function(){return mt}):"undefined"!=typeof module&&module.exports?module.exports=mt:"undefined"!=typeof this&&(this.ES6Promise=mt),pt()}.call(this);var R,Y,M,B=["Webkit","Moz","ms"],Z=document.createElement("div").style;Y=t("transform"),R=t("transformOrigin"),M=t("userSelect");var X="translate3d",j=", 0px",P=function(t,e,n){this.x=parseFloat(t),this.y=parseFloat(e),this.scale=parseFloat(n)};P.parse=function(t){return t.style?P.parse(t.style[Y]):t.indexOf("matrix")>-1||t.indexOf("none")>-1?P.fromMatrix(t):P.fromString(t)},P.fromMatrix=function(t){var e=t.substring(7).split(",");return e.length&&"none"!==t||(e=[1,0,0,1,0,0]),new P(parseInt(e[4],10),parseInt(e[5],10),parseFloat(e[0]))},P.fromString=function(t){var e=t.split(") "),n=e[0].substring(X.length+1).split(","),r=e.length>1?e[1].substring(6):1,o=n.length>1?n[0]:0,i=n.length>1?n[1]:0;return new P(o,i,r)},P.prototype.toString=function(){return X+"("+this.x+"px, "+this.y+"px"+j+") scale("+this.scale+")"};var z=function(t){if(!t||!t.style[R])return this.x=0,void(this.y=0);var e=t.style[R].split(" ");this.x=parseFloat(e[0]),this.y=parseFloat(e[1])};z.prototype.toString=function(){return this.x+"px "+this.y+"px"};var F=n(h,500);if(this.jQuery){var $=this.jQuery;$.fn.croppie=function(t){var e=typeof t;if("string"===e){var n=Array.prototype.slice.call(arguments,1),r=$(this).data("croppie");return"get"===t?r.get():"result"===t?r.result.apply(r,n):this.each(function(){var e=$(this).data("croppie");if(e){var r=e[t];if(!$.isFunction(r))throw"Croppie "+t+" method not found";r.apply(e,n),"destroy"===t&&$(this).removeData("croppie")}})}return this.each(function(){var e=new A(this,t);$(this).data("croppie",e)})}}A.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},customClass:"",showZoom:!0,mouseWheelZoom:!0,update:function(){}},e(A.prototype,{bind:function(t,e){return x.call(this,t,e)},get:function(){return C.call(this)},result:function(t){return E.call(this,t)},refresh:function(){return L.call(this)},destroy:function(){return S.call(this)}}),exports.Croppie=window.Croppie=A});